// concept -- Access
// tag::full[]
// tag::summary[]
You control document access by routing it to a channel and by making that channel accessible to the users or roles you want to be able to access documents of that type.

// end::summary[]
// tag::body[]

== Context

=== Sync Gateway

A user can only read documents that are in at least one of their assigned channels; whether directly or as part of an assigned role.

NOTE: All users can implicitly access any document in the {channels--xref-public-channel}

Once a user is granted access to a new channel, the {changes-feed--xref} will include all existing documents in that channel, even those from earlier sequences than the current request's `since` parameter.
So, the next replication pull request, will retrieve all documents to which the user now has access.

Revoking access to a channel means users who previously used the channel to get replicated documents will no longer see any synced updates.
However, documents already synced to the user's device are not deleted.

Note that access grants neither confer, nor constrain, the *type* of access.
Instead you can explicitly implement write access controls within the Sync Function; perhaps restricting updates to specific users or roles -- for more on this see {sgw--xref}{access-control-how--page}#lbl-control-write-access[Write Access].

=== Couchbase Lite
By default, Couchbase Lite gets all the channels to which the configured user account has access.
This behavior is suitable for most apps that rely on {authentication-users--xref} and the {sync-function--xref} to specify which data to pull for each user.

Optionally, a Couchbase Lite "pull" replication can also specify a comma-separated list of channel names to receive documents from.
In this case, the replication from Sync Gateway will only pull documents tagged with those channels.
Client apps can use this ability to intelligently sync with a subset of the available documents from the database.

:param-bookmark: channels
include::partial$blocklinks-cbl.adoc[]


== Use

There are a number of ways in which you can control access to documents, as illustrated in <<img-channel-access>>.

* Configuration -- You can do it in the {configuration-schema-static--xref} by adding the appropriate channel to the user's `admin_channels` property in the  see {configuration-schema-static--xref--databases-user-admin-channels}

* Admin REST API -- You can provide that same `admin_channels` property using the *Admin REST API* endpoint ({rest-api-admin-user-put--xref}).

* Programmatically -- The {sync-function--xref} provides a flexible and secure method for controlling document access and routing.
+
It can be programmed to derive appropriate access and routing information from document properties or, more securely, from a designated extended attribute (XATTR) -- see: {using-xattr-access-grants--xref} for how to define the XATTR.


[#img-channel-access]
.Access Control Points
====

image::channel-access-grant-all.png["Channel access",300]

<.> Documents are assigned to channel using the Sync Function's {sync-function-api-channel-cmd--xref} API.

<.> User can be granted access to channels by any one of the means defined here.

====

== Example

Consider the situation where two roles require, and are allowed, access to two distinct information flows and one shared flow -- see <<img-channels-example>>.

This can be achieved by:

. Creating two roles (Edge1 and Edge2) for the two groups of users.
+
--
Do this either by using the Admin Rest API endpoint  {rest-api-admin-role-post--xref} or statically by adding the role to the database in the {configuration-schema-static--xref}.
In either case specify that role Edge1 can access `Channel1`, Edge2 can access `Channel2`, and both roles can access & `Channel3` -- see: {access-control-how-create-roles--xref}
--

. Adding the roles to the appropriate users, again using either the configuration file or API -- see {access-control-how-add-roles-to-users--xref}

. Creating a Sync Function that

** Identifies and assigns appropriate documents to the right channel (or channels)
** Requires that any user accessing those channels has the right to do so; either directly or as in this case through a role assigned to them(Edge1 or Edge2).


[#img-channels-example]
.Access Control Example
====
This example shows three channels; one shared and two private.
Here {Edge1} and {Edge2} represent two groups of Sync Gateway users with the assigned roles Edge1 and Edge2 respectively.

image::channels-example-all.png[Channels,400]

<.> Documents are routed to the appropriate channels by Sync Function logic
<.> The Sync Function requires users (or one of their roles) has access to the channel

====

// end::body[]
// end::full[]