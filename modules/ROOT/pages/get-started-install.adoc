= Install Sync Gateway
:page-aliases: getting-started, start/get-started-install.adoc
:Description: Install a Sync Gateway Instance and securely sync enterprise data from cloud to edge
:page-type: procedural

include::partial$_std-hdr-sgw.adoc[]

:xref-pfx: {xref-pfx-sgw}:

:sg_download_link: {url-package-downloads}/{version-full}/
:sg_package_name: couchbase-sync-gateway-community_{version-full}_x86_64
:sg_package_name_ee: couchbase-sync-gateway-enterprise_{version-full}_x86_64
:sg_accel_package_name: couchbase-sync-gateway-enterprise_{version-full}_x86_64

:install-location: /opt/couchbase-sync-gateway/
:install-location-win: C:\Program Files\Couchbase\Sync Gateway\
:home-location: /users/sync_gateway/
:home-location-win: {install-location-win}
:logs-location: {home-location}logs
:logs-location-win: {home-location-win}var\lib\couchbase\logs
:snippet-header: source, bash, subs="noirmal, +attributes, +macros"


:topic-group: Start Here!
:param-related: {get-started-prepare-xref}  |  {get-started-verify-install-xref}
:param-abstract: This content explains how to install a Sync Gateway instance
include::partial$block-abstract.adoc[]


.Preparatory Steps
NOTE: Before starting the install, please ensure you have read, and acted-upon, the information in {get-started-prepare-xref}.

== Introduction
You can install Sync Gateway on any of the supported operating systems.

By default the installation process deploys the Sync Gateway package then defines and starts an example instance of Sync Gateway running as a service -- see the table in <<lbl-key-locns>> for the deployment locations.

By default Sync Gateway bases its initial setup on an example configuration filed `serviceconfig.json`.
This initial configuration has limited functionality.
It is intended primarily to verify the success of the installation by proving a connection to Sync Gateway can be made.

TIP: You can also run the *sync_gateway* binary directly from a terminal command line -- see: <<lbl-cmdln>>


== Download

Download the required edition of Sync Gateway from the {url-downloads}#couchbase-mobile[Couchbase downloads page].


.Alternatively, for Linux or Mac OS
--
[source,bash,subs="+attributes,+macros"]
----
wget {sg_download_link}<package-name>.<package-suffix> // <.> <.>
----

<.> Where <package-name> is one of:

* Enterprise Edition -- `{sg_package_name_ee}`
* Community Edition -- `{sg_package_name}`

<.> Where <package-suffix> is one of:

* Ubuntu -- `deb`
* Debian -- `deb`
* Red Hat / CentOS -- `rpm`
* Mac OS -- `tar.gz`

--


== Install

By default the installation process deploys the Sync Gateway package then defines and starts an example instance of Sync Gateway running as a service -- see the table in <<lbl-key-locns>> for the deployment locations.

If you want to provide your own configuration at this stage, or to change the default path to the configuration file that the service will use, you will need to edit the service installation script -- see: <<lbl-own-config>>


[{tabs}]
====
Ubuntu::
+
--
. Install sync_gateway with the dpkg package manager e.g:
+
[{snippet-header}]
----
dpkg -i {sg_package_name_ee}.deb
----
+
When the installation is complete Sync Gateway will be running as a service `sync_gateway`.
+
. To stop/start the `sync_gateway` service, use the methods show in <<ex-start-stop>>.

=====
--

Red Hat/CentOS::
+
--
. Install sync_gateway with the rpm package manager e.g:
+
[{snippet-header}]
----
rpm -i {sg_package_name_ee}.rpm
----
+
When the installation is complete sync_gateway will be running as a service.

. To stop/start the `sync_gateway` service, use the methods show in <<ex-start-stop>>.

--

Debian::
+
--
. Install sync_gateway with the dpkg package manager e.g:
+
[{snippet-header}]
----
dpkg -i {sg_package_name_ee}.deb
----
+
When the installation is complete Sync Gateway will be running as a service `sync_gateway`.

. To stop/start the `sync_gateway` service, use the methods show in <<ex-start-stop>>.

--

Windows::
+
--
. Open the installer and follow the instructions. +
If the installation was successful you will see the following:
+
image::windows-installation-complete.png[]

+
When the installation is complete Sync Gateway will be running as a service `SyncGateway`.
+
. To stop/start the `SyncGateway` service, use the methods show in <<ex-start-stop>>.

--

macOS::
+
--

. Unpack the tar.gz installer to the */opt* directory.
+
[{snippet-header}]
----
sudo tar -zxvf {sg_package_name_ee}.tar.gz --directory /opt
----

. (Optionally) -- Start Sync Gateway from the Command Line
+
[{snippet-header}]
----
{install-location}bin/sync_gateway
----

. (Optionally) -- Set Up Sync Gateway as a Service

.. Create a new macOS user.
+
[{snippet-header}]
----
sudo sysadminctl -addUser sync_gateway
----
If the operation is successful, you will get the following output.
+
[{snippet-header}]
----
sysadminctl ----------------------------
sysadminctl No clear text password or interactive option was specified (adduser, change/reset password will not allow user to use FDE) !
sysadminctl ----------------------------
sysadminctl Creating user record…
sysadminctl Assigning UID: 505
sysadminctl Creating home directory at /Users/sync_gateway
----
.. Create a new group and add the `sync_gateway` user to that group.
+
[{snippet-header}]
----
sudo dseditgroup -o create sync_gateway
sudo dseditgroup -o edit -a sync_gateway -t user sync_gateway
----

.. Define the Sync Gateway Service
+
[{snippet-header}]
----
cd {install-location}
sudo ./sync_gateway_service_install.sh
----
+
Other scripts in that directory are available to update or uninstall the service.
+
You can, optionally, provide a Sync Gateway configuration file path, which will be used instead of the default path whenever the service starts.
Do this by using the `--cfgpath` parameter.
For example: +
`sudo ./sync_gateway_service_install.sh --cfgpath sync-gateway-config.json`

.. To stop/start the `sync_gateway` service, use the methods show in <<ex-start-stop>>:

====

== Check
To check Sync Gateway started successfully, you can now connect to it from a browser by using either:

* http://localhost:4984[http://localhost:4984] for the Public API
* http://localhost:4985[http://localhost:4985] for the Admin API

You should receive a response in the browser such as: +
`{"couchdb":"Welcome","vendor":{"name":"Couchbase Sync Gateway","version":"2.8"},"version":"Couchbase Sync Gateway/2.8.0(145;e3f46be) EE"}`


== Running

=== Services

[#ex-start-stop]
.Starting and Stopping the Service
====
[{tabs}]
=====
Linux (systemd)::
+
--

[{snippet-header}]
----
systemctl start sync_gateway
systemctl stop sync_gateway
----
--
+
Linux (init)::
+
--
[{snippet-header}]
----
service sync_gateway start
service sync_gateway stop
----
--
+
Mac OS::
+
--
[{snippet-header}]
----
sudo launchctl load -w /Library/LaunchDaemons/com.couchbase.mobile.sync_gateway.plist <.>

sudo launchctl unload -w /Library/LaunchDaemons/com.couchbase.mobile.sync_gateway.plist <.>
----
<.> Here we load, and automatically start, the default sync_gateway service
<.> Here we unload the default sync_gateway service.
Note that it is not sufficient to `stop` the service.
It is configured to automatically restart.


--
+
Windows::
+
--
Use one of the following methods:

* Windows' Services application +
.. From the Start Menu, *Control Panel -> Admin Tools -> Services*
.. Within the Service panel, locate and kbd:[Right-Click] the service
.. From the Options Menu, select *Start* (or Stop) kbd:[Enter]

* Windows' command line utility `sc.exe`:
+
.Start Sync Gateway Service
[{snippet-header}]
----
c:\> sc start SyncGateway
----
+
This will result in a response such as:
+
[{snippet-header}]
----
SERVICE_NAME: SyncGateway
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 7420
        FLAGS              :
----
+
.Stop Sync Gateway Service
[{snippet-header}]
----
c:\> sc stop SyncGateway
----
+
This will result in a response such as:
+
[{snippet-header}]
----
SERVICE_NAME: SyncGateway
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 4  RUNNING
                                (STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0
----
--

====

[#lbl-cmdln]
=== Command Line
You can also start and stop Sync Gateway from a terminal command line using
the methods show in <<ex-cmd-start>>:

TIP: For other command-line options -- see {command-line-options-xref}

[#ex-cmd-start]
.Starting and Stopping at the Command Line]
====

[tabs]
=====
Linux  / MacOS Platforms::
+
--
[source,console, subs="+attributes, +macros"]
----
// <.>
{install-location}bin/sync_gateway <path-to-configuration-file> // <.>
----
<.> Where `{install-location}` is the location into which you deployed the Sync Gateway package.
<.> Where <path-to-configuration-file> resolves to a JSON format file containing the Sync Gateway configuration, for example, `{home-location}sync-gateway-config.json`

--

Windows Platforms::
+
--
[{snippet-header}]
----
c:\PROGRA~1\COUCHB~1\SYNCGA~1\SYNC_G~1.EXE <path-to-configuration-file> // <.>
----
<.> Where:
* The path to the executable uses Windows' short name notation
* <path-to-configuration-file> resolves to a JSON format file containing the Sync Gateway configuration, for example, `{home-location}sync-gateway-config.json`

--
=====

You can stop Sync Gateway instances started in this way by using kbd:[Ctrl+C].
There is no specific shutdown procedure and it is safe to stop it at any time.

====

[#lbl-key-locns]
== Key Locations

[tabs]
=====
.Default Sync Gateway File Locations:

Linux / Mac OS Platforms::
+
--
[#tbl-locns,cols="4,8,8a"]
|===

h|Content
h|Location
h|Example

|Configuration files
a|The `sync_gateway` user's home directory
|{home-location}

|Log files
|The `sync_gateway` user's home directory
|{home-location}logs/

|Binaries
|The installation directory
|{install-location}bin/

|===
--

Windows Platforms::
+
--

[#tbl-locns,cols="2,8a"]
|===

h|Content
h|Location

|Configuration files
|{home-location-win}

|Log files
|{logs-location-win}

|Binaries
|{install-location-win}

|===
--
=====

[#lbl-own-config]
== Using Your Own Config

By default the Sync Gateway service is set up to look for its config in a file named `sync_gateway.json` (or `serviceconfig.json` on Windows) -- see<<lbl-key-locns>> for its location.

To edit the configuration and use it in Sync Gateway, you can either:

* Continue to provide your config in this file.
You will need to restart Sync Gateway after each change.
* Run Sync Gateway from a command-line.
That way you can provide a path to the required config file as a parameter.
* Change the service to have the required path to the configuration file

.Change the Service's Configuration File Path
====
[tabs]
=====

Linux / Mac OS Platforms::
+
--
The Sync Gateway package contains a set of scripts to install, remove and upgrade Sync gateway services. They are located in the `{install-location}services` directory


--

Windows::
+
--
You can edit the `binpath` for the Sync Gateway service using Windows' command line utility `SC.exe`.

The format for the command you will use is:
[{snippet-header}]
----
sc <server> config SyncGateway binpath= "[path-to-sg-windows.exe] start [path-to-sync_gateway.exe] [path-to-config-file] [path-to-error-logs]" <.> <.>
----
<.> The <server> parameter is optional
<.> The rules for formatting the `binpath` value are quite complex:
.. The entire value must be in quotes
.. There must be one space (only) following the equals sign
.. Each of the [path-to ...] elements must be enclosed in quotes; these inner quotes must be escaped (for example `\"` ... `\"`)

This example changes the configuration file name from `serviceconfig.json` to `sync-gateway-config.json`

[{snippet-header}]
----
sc config SyncGateway binpath= “\”C:\Program Files\Couchbase\Sync Gateway\sg-windows.exe\” start \”C:\Program Files\Couchbase\Sync Gateway\sync_gateway.exe\” \”C:\Program Files\Couchbase\Sync Gateway\sync-gateway-config.json\” \”C:\Program Files\Couchbase\Sync Gateway\var\lib\couchbase\logs\sync_gateway_error.log\”"

----
--
=====
====

== Next Steps
Now that you have a working version of Sync Gateway, which you can connect a console to using either the Publi or Admin REST API, you can:

* Verify and explore the sync functionality using -- {get-started-verify-install--xref}
* Learn more about building Couchbase Mobile applications using the {couchbase-mobile-workshop-tutorial--xref} tutorial -- {}
* Learn more about the sync process
** {sync-with-couchbase-server--xref}
** {configuration-properties--xref}



include::partial$block-related-content-deploy.adoc[]
